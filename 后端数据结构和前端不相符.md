---
layout: post
title: 后端数据结构和前端不相符
date: 2017/04/05 19:33
tags: 数据 通信
comments: true
---
今天一个项目后端接口的数据结构和前端展示数据结构差距很大。后端给出一个类似于下面数据结构：
```
{
  list: [{  
    index: 1
    content: [{
        id: 1,
        name: "android"
    },{
        id: 3,
        name: "ios"
    },{
        id: 2,
        name: "wp"
    }]
  }]  
}
```
<!-- more -->
前端则需要展示一个表格样式。后端数据结构是有层级关系，前端的数据结构不是一个层级关系。前端希望下面的结构
```
{
    list: [{
        index: 1,
        android_id: 1,
        android_name: "android",
        ios_id: 3,
        ios_name: "ios",
        wp_id: 2,
        wp_name: "wp"        
    }]
}
```
当后端给出一个和前端不相符的数据结构。这种情况怎么处理？
肯定要对数据进行处理，处理的方式有两种。
1. 直接使用后端数据结构，前端展示过程中不断去遍历后端数据结构找到目标数据。
2. 自定义一套前端数据结构，在通信层中完成前后端数据的转换；

### 直接使用后端数据
当页面交互非常简单的情况下，比如展示一个列表，可以直接使用后端数据。但是如果页面有很复杂的交互，则不合适直接用后端数据。因为每一步的交互都有可能改变数据，这样的话需要频繁对数据结构进行遍历查找和修改。会导致代码逻辑越来越复杂。


### 自定义数据结构
在交互很复杂的情况下，建议前端自定义一套数据结构。首先将后端数据结构转为成前端自定义数据结构，然后前端所有操作都直接处理自定义数据结构，只有最后向服务器提交数据的时候才把自定义数据结构转换成后端数据结构。
后端结构转化为前端结构和前端结构转化为后端结构，这两种都放在通信层来完成，从而保证在前端业务逻辑中始终处理是前端数据结构。这一点很重要，__因为这种分层可以大大降低逻辑复杂度。__


两种方式优缺点对比

方法|优点|缺点
----|----|-----
直接使用后端数据| 逻辑相对简单只需要查找对应数据结构即可| 不合适有复杂交互的场景
自定义数据结构| 可以很好应对复杂交互场景| 需要额外增加前后端相互转换逻辑




